<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Video Recognition</title>
    <!-- Load TensorFlow.js. -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
    <style>
        #container {
            margin: 0px auto;
            width: 100px;
            height: 100px;
            border: 10px #333 solid;
        }

        #videoElement {
            width: 100px;
            height: 100px;
            background-color: #666;
        }
    </style>
</head>

<body>

    <div id="container">
        <video autoplay="true" id="videoElement">
        </video>
    </div>

    <button onclick="init()">Init</button>


    <script>

        let video = document.querySelector("#videoElement");

        let resulution_vga = { width: { exact: 100 }, height: { exact: 100 } };
        var self = this;
        var msc = { video: resulution_vga, audio: false };

        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices
                .getUserMedia(msc)
                .then(function (stream) {
                    const vid = self.videoElement;
                    // /!\ capture video once it got none zero resolution /!\
                    function inputDetection() {
                        if (vid.videoWidth === 0 || vid.videoHeight < 1) {
                            setTimeout(inputDetection, 100);
                            return;
                        }
                        self.width = vid.width = vid.videoWidth;
                        self.height = vid.height = vid.videoHeight;
                        // self.adjustVideoSize( 416,416 );
                        self.isReady = true;
                    }

                    self.videoStream = stream;
                    // vid.videoTracks;
                    vid.srcObject = stream;
                    vid.onloadedmetadata = () => {
                        inputDetection();
                    };
                })
                .catch(function (error) {
                    console.log(error);
                    alert("No camera found");
                });
        }

        let init = async () => {
            const model = await tf.loadLayersModel('http://localhost:3000/model/model.json');
            const example = tf.browser.fromPixels(video);  // for example
            console.log(example)
            const prediction = model.predict(example);
            console.log(prediction);
        }


    </script>
</body>

</html>